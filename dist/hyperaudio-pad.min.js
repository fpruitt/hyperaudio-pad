/*! hyperaudio-pad v0.1.1 ~ (c) 2012-2013 Hyperaudio Inc. <hello@hyperaud.io> (http://hyperaud.io) ~ Built: 25th October 2013 20:22:26 */
!function(a,b){function c(a){u.put.call(this,a)}function d(a){this.parent=a,this.byStart=[{start:-1,end:-1}],this.byEnd=[{start:-1,end:-1}],this.animating=[],this.startIndex=0,this.endIndex=0,this.previousUpdateTime=-1,Object.defineProperty(this,"count",{get:function(){return this.byStart.length}})}function e(a,b,c){return a[b]&&a[b]===c}function f(a,b){var c={};for(var d in a)l.call(b,d)&&l.call(a,d)&&(c[d]=a[d]);return c}function g(a,b){return function(){if(v.plugin.debug)return a.apply(this,arguments);try{return a.apply(this,arguments)}catch(c){v.plugin.errors.push({plugin:b,thrown:c,source:a.toString()}),this.emit("pluginerror",v.plugin.errors)}}}if(b.addEventListener){var h=Array.prototype,i=Object.prototype,j=h.forEach,k=h.slice,l=i.hasOwnProperty,m=i.toString,n=a.Popcorn,o=[],p=!1,q=!1,r={events:{hash:{},apis:{}}},s=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,16)}}(),t=function(a){return Object.keys?Object.keys(a):function(a){var b,c=[];for(b in a)l.call(a,b)&&c.push(b);return c}(a)},u={put:function(a){Object.getOwnPropertyNames(a).forEach(function(b){this[b]=a[b]},this)}},v=function(a,b){return new v.p.init(a,b||null)};v.version="@VERSION",v.isSupported=!0,v.instances=[],v.p=v.prototype={init:function(a,c){var e,f,g=this;{if("function"!=typeof a){if("string"==typeof a)try{e=b.querySelector(a)}catch(h){throw new Error("Popcorn.js Error: Invalid media element selector: "+a)}if(this.media=e||a,f=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video",this[f]=this.media,this.options=v.extend({},c)||{},this.id=this.options.id||v.guid(f),v.byId(this.id))throw new Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")");this.isDestroyed=!1,this.data={running:{cue:[]},timeUpdate:v.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:new d(this)},v.instances.push(this);var i=function(){g.media.currentTime<0&&(g.media.currentTime=0),g.media.removeEventListener("loadedmetadata",i,!1);var a,b,c,d,e,f;a=g.media.duration,b=a!=a?Number.MAX_VALUE:a+1,v.addTrackEvent(g,{start:b,end:b}),g.options.frameAnimation?(g.data.timeUpdate=function(){v.timeUpdate(g,{}),v.forEach(v.manifest,function(a,b){if(c=g.data.running[b]){e=c.length;for(var h=0;e>h;h++)d=c[h],f=d._natives,f&&f.frame&&f.frame.call(g,{},d,g.currentTime())}}),g.emit("timeupdate"),!g.isDestroyed&&s(g.data.timeUpdate)},!g.isDestroyed&&s(g.data.timeUpdate)):(g.data.timeUpdate=function(a){v.timeUpdate(g,a)},g.isDestroyed||g.media.addEventListener("timeupdate",g.data.timeUpdate,!1))};return Object.defineProperty(this,"error",{get:function(){return g.media.error}}),g.media.readyState>=1?i():g.media.addEventListener("loadedmetadata",i,!1),this}if("complete"===b.readyState)return a(b,v),void 0;if(o.push(a),!p){p=!0;var j=function(){q=!0,b.removeEventListener("DOMContentLoaded",j,!1);for(var a=0,c=o.length;c>a;a++)o[a].call(b,v);o=null};b.addEventListener("DOMContentLoaded",j,!1)}}}},v.p.init.prototype=v.p,v.byId=function(a){for(var b=v.instances,c=b.length,d=0;c>d;d++)if(b[d].id===a)return b[d];return null},v.forEach=function(a,b,c){if(!a||!b)return{};c=c||this;var d,e;if(j&&a.forEach===j)return a.forEach(b,c);if("[object NodeList]"===m.call(a)){for(d=0,e=a.length;e>d;d++)b.call(c,a[d],d,a);return a}for(d in a)l.call(a,d)&&b.call(c,a[d],d,a);return a},v.extend=function(a){var b=a,c=k.call(arguments,1);return v.forEach(c,function(a){for(var c in a)b[c]=a[c]}),b},v.extend(v,{noConflict:function(b){return b&&(a.Popcorn=n),v},error:function(a){throw new Error(a)},guid:function(a){return v.guid.counter++,(a?a:"")+(+new Date+v.guid.counter)},sizeOf:function(a){var b=0;for(var c in a)b++;return b},isArray:Array.isArray||function(a){return"[object Array]"===m.call(a)},nop:function(){},position:function(c){if(!c.parentNode)return null;var d,e,f,g,h,i,j=c.getBoundingClientRect(),k={},l=(c.ownerDocument,b.documentElement),m=b.body;d=l.clientTop||m.clientTop||0,e=l.clientLeft||m.clientLeft||0,f=a.pageYOffset&&l.scrollTop||m.scrollTop,g=a.pageXOffset&&l.scrollLeft||m.scrollLeft,h=Math.ceil(j.top+f-d),i=Math.ceil(j.left+g-e);for(var n in j)k[n]=Math.round(j[n]);return v.extend({},k,{top:h,left:i})},disable:function(a,b){if(!a.data.disabled[b]){if(a.data.disabled[b]=!0,b in v.registryByName&&a.data.running[b])for(var c,d=a.data.running[b].length-1;d>=0;d--)c=a.data.running[b][d],c._natives.end.call(a,null,c),a.emit("trackend",v.extend({},c,{plugin:c.type,type:"trackend"}));return a}},enable:function(a,b){if(a.data.disabled[b]){if(a.data.disabled[b]=!1,b in v.registryByName&&a.data.running[b])for(var c,d=a.data.running[b].length-1;d>=0;d--)c=a.data.running[b][d],c._natives.start.call(a,null,c),a.emit("trackstart",v.extend({},c,{plugin:c.type,type:"trackstart",track:c}));return a}},destroy:function(a){var b,c,d,e,f=a.data.events,g=a.data.trackEvents;for(c in f){b=f[c];for(d in b)delete b[d];f[c]=null}for(e in v.registryByName)v.removePlugin(a,e);g.byStart.length=0,g.byEnd.length=0,a.isDestroyed||(a.data.timeUpdate&&a.media.removeEventListener("timeupdate",a.data.timeUpdate,!1),a.isDestroyed=!0),v.instances.splice(v.instances.indexOf(a),1)}}),v.guid.counter=1,v.extend(v.p,function(){var a="load play pause currentTime playbackRate volume duration preload playbackRate autoplay loop controls muted buffered readyState seeking paused played seekable ended",b={};return v.forEach(a.split(/\s+/g),function(a){b[a]=function(b){var c;return"function"==typeof this.media[a]?(null!=b&&/play|pause/.test(a)&&(this.media.currentTime=v.util.toSeconds(b)),this.media[a](),this):null!=b?(c=this.media[a],this.media[a]=b,c!==b&&this.emit("attrchange",{attribute:a,previousValue:c,currentValue:b}),this):this.media[a]}}),b}()),v.forEach("enable disable".split(" "),function(a){v.p[a]=function(b){return v[a](this,b)}}),v.extend(v.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(a,b,d){var e,f,g,h=arguments.length,i="trackadded";try{f=v.util.toSeconds(a)}catch(j){}if("number"==typeof f&&(a=f),"number"==typeof a&&2===h)d=b,b=a,a=v.guid("cue");else if(1===h)b=-1;else if(e=this.getTrackEvent(a))this.data.trackEvents.remove(a),c.end(this,e),v.removeTrackEvent.ref(this,a),i="cuechange","string"==typeof a&&2===h&&("number"==typeof b&&(d=e._natives.start),"function"==typeof b&&(d=b,b=e.start));else if(h>=2){if("string"==typeof b){try{f=v.util.toSeconds(b)}catch(j){}b=f}"number"==typeof b&&(d=d||v.nop()),"function"==typeof b&&(d=b,b=-1)}return g={id:a,start:b,end:b+1,_running:!1,_natives:{start:d||v.nop,end:v.nop,type:"cue"}},e&&(g=v.extend(e,g)),"cuechange"===i?(g._id=g.id||g._id||v.guid(g._natives.type),this.data.trackEvents.add(g),c.start(this,g),this.timeUpdate(this,null,!0),v.addTrackEvent.ref(this,g),this.emit(i,v.extend({},g,{id:a,type:i,previousValue:{time:e.start,fn:e._natives.start},currentValue:{time:b,fn:d||v.nop},track:e}))):v.addTrackEvent(this,g),this},mute:function(a){var b=null==a||a===!0?"muted":"unmuted";return"unmuted"===b&&(this.media.muted=!1,this.media.volume=this.data.state.volume),"muted"===b&&(this.data.state.volume=this.media.volume,this.media.muted=!0),this.emit(b),this},unmute:function(a){return this.mute(null==a?!1:!a)},position:function(){return v.position(this.media)},toggle:function(a){return v[this.data.disabled[a]?"enable":"disable"](this,a)},defaults:function(a,b){return v.isArray(a)?(v.forEach(a,function(a){for(var b in a)this.defaults(b,a[b])},this),this):(this.options.defaults||(this.options.defaults={}),this.options.defaults[a]||(this.options.defaults[a]={}),v.extend(this.options.defaults[a],b),this)}}),v.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange"},v.Events.Natives=v.Events.UIEvents+" "+v.Events.MouseEvents+" "+v.Events.Events,r.events.apiTypes=["UIEvents","MouseEvents","Events"],function(a,b){for(var c=r.events.apiTypes,d=a.Natives.split(/\s+/g),e=0,f=d.length;f>e;e++)b.hash[d[e]]=!0;c.forEach(function(c){b.apis[c]={};for(var d=a[c].split(/\s+/g),e=d.length,f=0;e>f;f++)b.apis[c][d[f]]=!0})}(v.Events,r.events),v.events={isNative:function(a){return!!r.events.hash[a]},getInterface:function(a){if(!v.events.isNative(a))return!1;for(var b,c,d=r.events,e=d.apiTypes,f=d.apis,g=0,h=e.length;h>g;g++)if(c=e[g],f[c][a]){b=c;break}return b},all:v.Events.Natives.split(/\s+/g),fn:{trigger:function(c,d){var e,f,g,h=this.data.events[c];if(h){if(e=v.events.getInterface(c))return f=b.createEvent(e),f.initEvent(c,!0,!0,a,1),this.media.dispatchEvent(f),this;for(g=h.slice();g.length;)g.shift().call(this,d)}return this},listen:function(a,b){var c,d,e=this,f=!0,g=v.events.hooks[a];if("function"!=typeof b)throw new Error("Popcorn.js Error: Listener is not a function");return this.data.events[a]||(this.data.events[a]=[],f=!1),g&&(g.add&&g.add.call(this,{},b),g.bind&&(a=g.bind),g.handler&&(d=b,b=function(a){g.handler.call(e,a,d)}),f=!0,this.data.events[a]||(this.data.events[a]=[],f=!1)),this.data.events[a].push(b),!f&&v.events.all.indexOf(a)>-1&&this.media.addEventListener(a,function(b){if(e.data.events[a])for(c=e.data.events[a].slice();c.length;)c.shift().call(e,b)},!1),this},unlisten:function(a,b){var c,d=this.data.events[a];if(d){if("string"==typeof b){for(var e=0;e<d.length;e++)d[e].name===b&&d.splice(e--,1);return this}if("function"==typeof b){for(;-1!==c;)c=d.indexOf(b),-1!==c&&d.splice(c,1);return this}return this.data.events[a]=null,this}}},hooks:{canplayall:{bind:"canplaythrough",add:function(a,b){var c=!1;this.media.readyState&&(setTimeout(function(){b.call(this,a)}.bind(this),0),c=!0),this.data.hooks.canplayall={fired:c}},handler:function(a,b){this.data.hooks.canplayall.fired||(b.call(this,a),this.data.hooks.canplayall.fired=!0)}}}},v.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(a){v.p[a[0]]=v.p[a[1]]=v.events.fn[a[0]]}),c.start=function(a,b){b.end>a.media.currentTime&&b.start<=a.media.currentTime&&!b._running&&(b._running=!0,a.data.running[b._natives.type].push(b),a.data.disabled[b._natives.type]||(b._natives.start.call(a,null,b),a.emit("trackstart",v.extend({},b,{plugin:b._natives.type,type:"trackstart",track:b}))))},c.end=function(a,b){var c;(b.end<=a.media.currentTime||b.start>a.media.currentTime)&&b._running&&(c=a.data.running[b._natives.type],b._running=!1,c.splice(c.indexOf(b),1),a.data.disabled[b._natives.type]||(b._natives.end.call(a,null,b),a.emit("trackend",v.extend({},b,{plugin:b._natives.type,type:"trackend",track:b}))))},d.prototype.where=function(a){return(this.parent.getTrackEvents()||[]).filter(function(b){var c,d;if(!a)return!0;for(c in a)if(d=a[c],e(b,c,d)||e(b._natives,c,d))return!0;return!1})},d.prototype.add=function(a){var b,c,d=this.byStart,e=this.byEnd;for(a&&a._id&&this.parent.data.history.push(a._id),a.start=v.util.toSeconds(a.start,this.parent.options.framerate),a.end=v.util.toSeconds(a.end,this.parent.options.framerate),b=d.length-1;b>=0;b--)if(a.start>=d[b].start){d.splice(b+1,0,a);break}for(c=e.length-1;c>=0;c--)if(a.end>e[c].end){e.splice(c+1,0,a);break}b<=this.parent.data.trackEvents.startIndex&&a.start<=this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.startIndex++,c<=this.parent.data.trackEvents.endIndex&&a.end<this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.endIndex++},d.prototype.remove=function(a,b){if(a instanceof c&&(a=a.id),"object"==typeof a)return this.where(a).forEach(function(a){this.removeTrackEvent(a._id)},this.parent),this;var d,e,f,g,h,i=this.byStart.length,j=0,k=0,l=[],m=[],n=[],o=[];for(b=b||{};--i>-1;)d=this.byStart[j],e=this.byEnd[j],d._id||(l.push(d),m.push(e)),d._id&&(d._id!==a&&l.push(d),e._id!==a&&m.push(e),d._id===a&&(k=j,h=d)),j++;if(i=this.animating.length,j=0,i)for(;--i>-1;)f=this.animating[j],f._id||n.push(f),f._id&&f._id!==a&&n.push(f),j++;k<=this.startIndex&&this.startIndex--,k<=this.endIndex&&this.endIndex--,this.byStart=l,this.byEnd=m,this.animating=n,g=this.parent.data.history.length;for(var p=0;g>p;p++)this.parent.data.history[p]!==a&&o.push(this.parent.data.history[p]);this.parent.data.history=o},v.addTrackEvent=function(a,b){var d;b instanceof c||(b=new c(b),b&&b._natives&&b._natives.type&&a.options.defaults&&a.options.defaults[b._natives.type]&&(d=v.extend({},b),v.extend(b,a.options.defaults[b._natives.type],d)),b._natives&&(b._id=b.id||b._id||v.guid(b._natives.type),b._natives._setup&&(b._natives._setup.call(a,b),a.emit("tracksetup",v.extend({},b,{plugin:b._natives.type,type:"tracksetup",track:b})))),a.data.trackEvents.add(b),c.start(a,b),this.timeUpdate(a,null,!0),b._id&&v.addTrackEvent.ref(a,b),a.emit("trackadded",v.extend({},b,b._natives?{plugin:b._natives.type}:{},{type:"trackadded",track:b})))},v.addTrackEvent.ref=function(a,b){return a.data.trackRefs[b._id]=b,a},v.removeTrackEvent=function(a,b){var c=a.getTrackEvent(b);c&&(c._natives._teardown&&c._natives._teardown.call(a,c),a.data.trackEvents.remove(b),v.removeTrackEvent.ref(a,b),c._natives&&a.emit("trackremoved",v.extend({},c,{plugin:c._natives.type,type:"trackremoved",track:c})))},v.removeTrackEvent.ref=function(a,b){return delete a.data.trackRefs[b],a},v.getTrackEvents=function(a){for(var b,c=[],d=a.data.trackEvents.byStart,e=d.length,f=0;e>f;f++)b=d[f],b._id&&c.push(b);return c},v.getTrackEvents.ref=function(a){return a.data.trackRefs},v.getTrackEvent=function(a,b){return a.data.trackRefs[b]},v.getTrackEvent.ref=function(a,b){return a.data.trackRefs[b]},v.getLastTrackEventId=function(a){return a.data.history[a.data.history.length-1]},v.timeUpdate=function(a,b){var c,d,e,f,g,h=a.media.currentTime,i=a.data.trackEvents.previousUpdateTime,j=a.data.trackEvents,k=j.endIndex,l=j.startIndex,m=j.byStart.length,n=j.byEnd.length,o=v.registryByName,p="trackstart",q="trackend";if(h>=i){for(;j.byEnd[k]&&j.byEnd[k].end<=h;){if(c=j.byEnd[k],e=c._natives,f=e&&e.type,e&&!o[f]&&!a[f])return v.removeTrackEvent(a,c._id),void 0;c._running===!0&&(c._running=!1,g=a.data.running[f],g.splice(g.indexOf(c),1),a.data.disabled[f]||(e.end.call(a,b,c),a.emit(q,v.extend({},c,{plugin:f,type:q,track:c})))),k++}for(;j.byStart[l]&&j.byStart[l].start<=h;){if(d=j.byStart[l],e=d._natives,f=e&&e.type,e&&!o[f]&&!a[f])return v.removeTrackEvent(a,d._id),void 0;d.end>h&&d._running===!1&&(d._running=!0,a.data.running[f].push(d),a.data.disabled[f]||(e.start.call(a,b,d),a.emit(p,v.extend({},d,{plugin:f,type:p,track:d})))),l++}}else if(i>h){for(;j.byStart[l]&&j.byStart[l].start>h;){if(d=j.byStart[l],e=d._natives,f=e&&e.type,e&&!o[f]&&!a[f])return v.removeTrackEvent(a,d._id),void 0;d._running===!0&&(d._running=!1,g=a.data.running[f],g.splice(g.indexOf(d),1),a.data.disabled[f]||(e.end.call(a,b,d),a.emit(q,v.extend({},d,{plugin:f,type:q,track:d})))),l--}for(;j.byEnd[k]&&j.byEnd[k].end>h;){if(c=j.byEnd[k],e=c._natives,f=e&&e.type,e&&!o[f]&&!a[f])return v.removeTrackEvent(a,c._id),void 0;c.start<=h&&c._running===!1&&(c._running=!0,a.data.running[f].push(c),a.data.disabled[f]||(e.start.call(a,b,c),a.emit(p,v.extend({},c,{plugin:f,type:p,track:c})))),k--}}j.endIndex=k,j.startIndex=l,j.previousUpdateTime=h,j.byStart.length<m&&j.startIndex--,j.byEnd.length<n&&j.endIndex--},v.extend(v.p,{getTrackEvents:function(){return v.getTrackEvents.call(null,this)},getTrackEvent:function(a){return v.getTrackEvent.call(null,this,a)},getLastTrackEventId:function(){return v.getLastTrackEventId.call(null,this)},removeTrackEvent:function(a){return v.removeTrackEvent.call(null,this,a),this},removePlugin:function(a){return v.removePlugin.call(null,this,a),this},timeUpdate:function(a){return v.timeUpdate.call(null,this,a),this},destroy:function(){return v.destroy.call(null,this),this}}),v.manifest={},v.registry=[],v.registryByName={},v.plugin=function(a,b,d){if(v.protect.natives.indexOf(a.toLowerCase())>=0)return v.error("'"+a+"' is a protected function name"),void 0;var e="function"==typeof b,h=["start","end","type","manifest"],i=["_setup","_teardown","start","end","frame"],j={},m=function(a,b){return a=a||v.nop,b=b||v.nop,function(){a.apply(this,arguments),b.apply(this,arguments)}};v.manifest[a]=d=d||b.manifest||{},i.forEach(function(c){b[c]=g(b[c]||v.nop,a)});var n=function(b,e){if(!e)return this;if(e.ranges&&v.isArray(e.ranges))return v.forEach(e.ranges,function(b){var c=v.extend({},e,b);delete c.ranges,this[a](c)},this),this;var f,g=e._natives={},j="";return v.extend(g,b),e._natives.type=e._natives.plugin=a,e._running=!1,g.start=g.start||g["in"],g.end=g.end||g.out,e.once&&(g.end=m(g.end,function(){this.removeTrackEvent(e._id)})),g._teardown=m(function(){var a=k.call(arguments),b=this.data.running[g.type];a.unshift(null),a[1]._running&&b.splice(b.indexOf(e),1)&&g.end.apply(this,a),a[1]._running=!1,this.emit("trackend",v.extend({},e,{plugin:g.type,type:"trackend",track:v.getTrackEvent(this,e.id||e._id)}))},g._teardown),g._teardown=m(g._teardown,function(){this.emit("trackteardown",v.extend({},e,{plugin:a,type:"trackteardown",track:v.getTrackEvent(this,e.id||e._id)}))}),e.compose=e.compose||[],"string"==typeof e.compose&&(e.compose=e.compose.split(" ")),e.effect=e.effect||[],"string"==typeof e.effect&&(e.effect=e.effect.split(" ")),e.compose=e.compose.concat(e.effect),e.compose.forEach(function(a){j=v.compositions[a]||{},i.forEach(function(a){g[a]=m(g[a],j[a])})}),e._natives.manifest=d,"start"in e||(e.start=e["in"]||0),e.end||0===e.end||(e.end=e.out||Number.MAX_VALUE),l.call(e,"toString")||(e.toString=function(){var b=["start: "+e.start,"end: "+e.end,"id: "+(e.id||e._id)];return null!=e.target&&b.push("target: "+e.target),a+" ( "+b.join(", ")+" )"}),e.target||(f="options"in d&&d.options,e.target=f&&"target"in f&&f.target),!e._id&&e._natives&&(e._id=v.guid(e._natives.type)),e instanceof c?(e._natives&&(e._id=e.id||e._id||v.guid(e._natives.type),e._natives._setup&&(e._natives._setup.call(this,e),this.emit("tracksetup",v.extend({},e,{plugin:e._natives.type,type:"tracksetup",track:e})))),this.data.trackEvents.add(e),c.start(this,e),this.timeUpdate(this,null,!0),e._id&&v.addTrackEvent.ref(this,e)):v.addTrackEvent(this,e),v.forEach(b,function(a,b){-1===h.indexOf(b)&&this.on(b,a)},this),this};v.p[a]=j[a]=function(d,g){var h,i,j,k,m;if(arguments.length,d&&!g)g=d,d=null;else{if(h=this.getTrackEvent(d))return m=g,k=f(h,m),h._natives._update?(this.data.trackEvents.remove(h),l.call(g,"start")&&(h.start=g.start),l.call(g,"end")&&(h.end=g.end),c.end(this,h),e&&b.call(this,h),h._natives._update.call(this,h,g),this.data.trackEvents.add(h),c.start(this,h),"cue"!==h._natives.type&&this.emit("trackchange",{id:h.id,type:"trackchange",previousValue:k,currentValue:m,track:h}),this):(v.extend(h,g),this.data.trackEvents.remove(d),h._natives._teardown&&h._natives._teardown.call(this,h),v.removeTrackEvent.ref(this,d),e?n.call(this,b.call(this,h),h):(h._id=h.id||h._id||v.guid(h._natives.type),h._natives&&h._natives._setup&&(h._natives._setup.call(this,h),this.emit("tracksetup",v.extend({},h,{plugin:h._natives.type,type:"tracksetup",track:h}))),this.data.trackEvents.add(h),c.start(this,h),this.timeUpdate(this,null,!0),v.addTrackEvent.ref(this,h)),this.emit("trackchange",{id:h.id,type:"trackchange",previousValue:k,currentValue:h,track:h}),this);g.id=d}return this.data.running[a]=this.data.running[a]||[],i=this.options.defaults&&this.options.defaults[a]||{},j=v.extend({},i,g),n.call(this,e?b.call(this,j):b,j),this},d&&v.extend(b,{manifest:d});var o={fn:j[a],definition:b,base:b,parents:[],name:a};return v.registry.push(v.extend(j,o,{type:a})),v.registryByName[a]=o,j},v.plugin.errors=[],v.plugin.debug="@VERSION"===v.version,v.removePlugin=function(a,b){if(!b){if(b=a,a=v.p,v.protect.natives.indexOf(b.toLowerCase())>=0)return v.error("'"+b+"' is a protected function name"),void 0;var c,d=v.registry.length;for(c=0;d>c;c++)if(v.registry[c].name===b)return v.registry.splice(c,1),delete v.registryByName[b],delete v.manifest[b],delete a[b],void 0}var e,f,g=a.data.trackEvents.byStart,h=a.data.trackEvents.byEnd,i=a.data.trackEvents.animating;for(e=0,f=g.length;f>e;e++)g[e]&&g[e]._natives&&g[e]._natives.type===b&&(g[e]._natives._teardown&&g[e]._natives._teardown.call(a,g[e]),g.splice(e,1),e--,f--,a.data.trackEvents.startIndex<=e&&(a.data.trackEvents.startIndex--,a.data.trackEvents.endIndex--)),h[e]&&h[e]._natives&&h[e]._natives.type===b&&h.splice(e,1);for(e=0,f=i.length;f>e;e++)i[e]&&i[e]._natives&&i[e]._natives.type===b&&(i.splice(e,1),e--,f--)},v.compositions={},v.compose=function(a,b,c){v.manifest[a]=c=c||b.manifest||{},v.compositions[a]=b},v.plugin.effect=v.effect=v.compose;var w=/^(?:\.|#|\[)/;v.dom={debug:!1,find:function(a,c){var d=null;if(c=c||b,a){if(!w.test(a)&&(d=b.getElementById(a),null!==d))return d;try{d=c.querySelector(a)}catch(e){if(v.dom.debug)throw new Error(e)}}return d}};var x=/\?/,y={ajax:null,url:"",data:"",dataType:"",success:v.nop,type:"GET",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};v.xhr=function(a){var b;return a.dataType=a.dataType&&a.dataType.toLowerCase()||null,!a.dataType||"jsonp"!==a.dataType&&"script"!==a.dataType?(b=v.extend({},y,a),b.ajax=new XMLHttpRequest,b.ajax?("GET"===b.type&&b.data&&(b.url+=(x.test(b.url)?"&":"?")+b.data,b.data=null),b.ajax.open(b.type,b.url,b.async),"POST"===b.type&&b.ajax.setRequestHeader("Content-Type",b.contentType),b.ajax.send(b.data||null),v.xhr.httpData(b)):void 0):(v.xhr.getJSONP(a.url,a.success,"script"===a.dataType),void 0)},v.xhr.httpData=function(a){var b,c,d=null,e=null;return a.ajax.onreadystatechange=function(){if(4===a.ajax.readyState){try{d=JSON.parse(a.ajax.responseText)}catch(f){}if(b={xml:a.ajax.responseXML,text:a.ajax.responseText,json:d},!b.xml||!b.xml.documentElement){b.xml=null;try{c=new DOMParser,e=c.parseFromString(a.ajax.responseText,"text/xml"),e.getElementsByTagName("parsererror").length||(b.xml=e)}catch(f){}}a.dataType&&(b=b[a.dataType]),a.success.call(a.ajax,b)}},b},v.xhr.getJSONP=function(a,c,d){var e,f,g,h=b.head||b.getElementsByTagName("head")[0]||b.documentElement,i=b.createElement("script"),j=!1,k=[],l=/(=)\?(?=&|$)|\?\?/;d||(g=a.match(/(callback=[^&]*)/),null!==g&&g.length?(e=g[1].split("=")[1],"?"===e&&(e="jsonp"),f=v.guid(e),a=a.replace(/(callback=[^&]*)/,"callback="+f)):(f=v.guid("jsonp"),l.test(a)&&(a=a.replace(l,"$1"+f)),k=a.split(/\?(.+)?/),a=k[0]+"?",k[1]&&(a+=k[1]+"&"),a+="callback="+f),window[f]=function(a){c&&c(a),j=!0}),i.addEventListener("load",function(){d&&c&&c(),j&&delete window[f],h.removeChild(i)},!1),i.src=a,h.insertBefore(i,h.firstChild)},v.getJSONP=v.xhr.getJSONP,v.getScript=v.xhr.getScript=function(a,b){return v.xhr.getJSONP(a,b,!0)},v.util={toSeconds:function(a,b){var c,d,e,f,g,h,i=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,j="Invalid time format";return"number"==typeof a?a:("string"!=typeof a||i.test(a)||v.error(j),c=a.split(":"),d=c.length-1,e=c[d],e.indexOf(";")>-1&&(g=e.split(";"),h=0,b&&"number"==typeof b&&(h=parseFloat(g[1],10)/b),c[d]=parseInt(g[0],10)+h),f=c[0],{1:parseFloat(f,10),2:60*parseInt(f,10)+parseFloat(c[1],10),3:3600*parseInt(f,10)+60*parseInt(c[1],10)+parseFloat(c[2],10)}[c.length||1])}},v.p.cue=v.p.exec,v.protect={natives:t(v.p).map(function(a){return a.toLowerCase()})},v.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(a,b){var c=v.p[b];v.p[b]=function(){return"undefined"!=typeof console&&console.warn&&(console.warn("Deprecated method '"+b+"', "+(null==a?"do not use.":"use '"+a+"' instead.")),v.p[b]=c),v.p[a].apply(this,[].slice.call(arguments))}}),a.Popcorn=v}else{a.Popcorn={isSupported:!1};for(var z="byId forEach extend effects error guid sizeOf isArray nop position disable enable destroyaddTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId timeUpdate plugin removePlugin compose effect xhr getJSONP getScript".split(/\s+/);z.length;)a.Popcorn[z.shift()]=function(){}}}(window,window.document),function(a){a.plugin("transcript",function(){var a;return{manifest:{about:{name:"Popcorn Transcript Plugin",version:"0.2",author:"Mark Panaghiston",website:"http://www.jplayer.org/"},options:{time:{elem:"input",type:"text",label:"In"},target:"Transcript-container",futureClass:{elem:"input",type:"text",label:"Class"},onNewPara:function(){}}},_setup:function(b){var c,d;if(b.target&&"string"==typeof b.target&&"Transcript-container"!==b.target)b.container=document.getElementById(b.target);else{if(!b.target||"object"!=typeof b.target)throw"Popcorn.transcript: target property must be an ID string or a pointer to the DOM of the transcript word.";b.container=b.target}b.start=0,b.end=b.time,b.futureClass||(b.futureClass="transcript-future"),c=b.target.parentNode,c!==a&&(d=!0,a=c),b.transcriptRead=function(){b.container.classList?b.container.classList.remove(b.futureClass):b.container.className="",d&&"function"==typeof b.onNewPara&&b.onNewPara(b.target.parentNode)},b.transcriptFuture=function(){b.container.classList?b.container.classList.add(b.futureClass):b.container.className=b.futureClass},b.end>b.start&&b.transcriptFuture()},_update:function(){},_teardown:function(){},start:function(a,b){b.transcriptFuture()},end:function(a,b){b.transcriptRead()}}}())}(Popcorn);var HA=function(a,b){var c=function(){function a(){}function c(b){var c=b.length,d=a.type(b);return a.isWindow(b)?!1:1===b.nodeType&&c?!0:"array"===d||"function"!==d&&(0===c||"number"==typeof c&&c>0&&c-1 in b)}var d={},e=d.toString,f=d.hasOwnProperty;return a.extend=function(){var b,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||a.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(b=arguments[i]))for(c in b)d=h[c],e=b[c],h!==e&&(k&&e&&(a.isPlainObject(e)||(f=a.isArray(e)))?(f?(f=!1,g=d&&a.isArray(d)?d:[]):g=d&&a.isPlainObject(d)?d:{},h[c]=a.extend(k,g,e)):void 0!==e&&(h[c]=e));return h},a.extend({isFunction:function(b){return"function"===a.type(b)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?d[e.call(a)]||"object":typeof a},isPlainObject:function(b){if("object"!==a.type(b)||b.nodeType||a.isWindow(b))return!1;try{if(b.constructor&&!f.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!0}}),a.extend({each:function(a,b){var d,e=0,f=a.length,g=c(a);if(g)for(;f>e&&(d=b.call(a[e],e,a[e]),d!==!1);e++);else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a}}),a.extend({event:{ready:"ha:ready",load:"ha:load",save:"ha:save",error:"ha:error"},_commonMethods:{options:{DEBUG:!0,entity:"core"},_trigger:function(b,c){var d=a.extend(!0,{options:this.options},c),e=new CustomEvent(b,{detail:d,bubbles:!0,cancelable:!0});this.target.dispatchEvent(e)},_error:function(b){var c={msg:this.options.entity+" Error : "+b};this._trigger(a.event.error,c)},_debug:function(){var b=this;a.each(a.event,function(a,c){b.target.addEventListener(c,function(a){console.log(b.options.entity+" "+c+" event : %o",a)},!1)})}},register:function(b,c){"string"==typeof b&&("function"==typeof c?(c.prototype=a.extend({},this._commonMethods,c.prototype),this[b]=function(a){return new c(a)}):"object"==typeof c&&(c=a.extend({},this._commonMethods,c),this[b]=c))},utility:function(a,b){"string"==typeof a&&(this[a]=b)},jsonp:function(a,c,d){b.getElementsByTagName("head")[0];var e=b.createElement("script");e.type="text/javascript";var f=0;d[f++]=function(){d.call(c,data)},e.src=a},hasClass:function(a,b){if(!a)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},addClass:function(a,b){this.hasClass(a,b)||(a.className+=" "+b)},removeClass:function(a,b){if(this.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ").replace(/\s{2,}/g," ")}},toggleClass:function(a,b){this.hasClass(a,b)?this.removeClass(a,b):this.addClass(a,b)}}),a}(),d=function(a,b,c){function d(a){this.options={handle:null,dropArea:null,init:!0,touch:!0,mouse:!0,timeout:500,html:"",draggableClass:"",containerTag:"article",blockTag:"section"};for(var c in a)this.options[c]=a[c];this.dropArea="string"==typeof this.options.dropArea?b.querySelector(this.options.dropArea):this.options.dropArea,this.list=this.dropArea.querySelector(this.options.containerTag),this.list||(this.list=b.createElement(this.options.containerTag),this.dropArea.appendChild(this.list)),this.placeholder=b.createElement(this.options.blockTag),this.placeholder.className="placeholder",this.options.init&&(this.handle="string"==typeof this.options.handle?b.querySelector(this.options.handle):this.options.handle,this.handleClassName=this.handle.className,this.reordering=this.handle.parentNode==this.list,this.options.touch&&this.handle.addEventListener("touchstart",this,!1),this.options.mouse&&this.handle.addEventListener("mousedown",this,!1))}return d.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},d.prototype.start=function(a){var c=a.touches?a.touches[0]:a,d=a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target;/INPUT/.test(d.tagName)||(a.preventDefault(),this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1),clearTimeout(this.dragTimeout),this.initiated=!1,this.lastTarget=null,this.dragTimeout=setTimeout(this.init.bind(this,this.options.html||this.handle.innerHTML,a),this.options.timeout))},d.prototype.init=function(a,c){this.options.init||(this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1)),this.draggable=b.createElement("div"),this.draggable.className="draggable "+this.options.draggableClass,this.draggableStyle=this.draggable.style,this.draggableStyle.cssText="position:absolute;z-index:1000;pointer-events:none;left:-99999px",this.draggable.innerHTML=a,b.body.appendChild(this.draggable),this.draggableCenterX=Math.round(this.draggable.offsetWidth/2),this.draggableCenterY=Math.round(this.draggable.offsetHeight/2),this.position(c),this.options.touch&&b.addEventListener("touchmove",this,!1),this.options.mouse&&b.addEventListener("mousemove",this,!1),this.initiated=!0,this.reordering&&(this.handle.style.display="none"),this.move(c),this.options.onDragStart&&this.options.onDragStart.call(this)},d.prototype.position=function(a){var b=a.changedTouches?a.changedTouches[0]:a;this.draggableStyle.left=b.pageX-this.draggableCenterX+"px",this.draggableStyle.top=b.pageY-this.draggableCenterY+"px"},d.prototype.move=function(a){a.preventDefault(),a.stopPropagation();var d=a.changedTouches?a.changedTouches[0]:a,e=a.touches?b.elementFromPoint(d.pageX,d.pageY):d.target;if(this.position(a),e!=this.lastTarget&&e!=this.placeholder&&e!=this.list){if(this.lastTarget=e,e==this.dropArea)return this.list.appendChild(this.placeholder),void 0;if(c.hasClass(e,"item")){for(var f=this.list.querySelectorAll(".item"),g=0,h=f.length;h>g;g++)if(e==f[g]){this.list.insertBefore(this.placeholder,f[g]);break}}else this.list.querySelector(".placeholder")&&this.placeholder.parentNode.removeChild(this.placeholder)}},d.prototype.end=function(a){if(clearTimeout(this.dragTimeout),b.removeEventListener("touchend",this,!1),b.removeEventListener("mouseup",this,!1),this.initiated){b.removeEventListener("touchmove",this,!1),b.removeEventListener("mousemove",this,!1);var c=a.changedTouches?a.changedTouches[0]:a;a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target;var d=this.options.html?this.handle.innerHTML:this.draggable.innerHTML;if(this.draggable.parentNode.removeChild(this.draggable),this.draggable=null,!this.list.querySelector(".placeholder"))return this.reordering&&this.handle.parentNode.removeChild(this.handle),this.options.onDrop&&this.options.onDrop.call(this,null),void 0;var e;this.reordering?(e=this.handle,this.handle.style.display=""):(e=b.createElement(this.options.blockTag),e.className=this.handleClassName||"item",e.innerHTML=d),this.list.insertBefore(e,this.placeholder),this.placeholder.parentNode.removeChild(this.placeholder),this.options.onDrop&&this.options.onDrop.call(this,e)}},d.prototype.destroy=function(){b.removeEventListener("touchstart",this,!1),b.removeEventListener("touchmove",this,!1),b.removeEventListener("touchend",this,!1),b.removeEventListener("mousedown",this,!1),b.removeEventListener("mousemove",this,!1),b.removeEventListener("mouseup",this,!1)},d}(a,b,c),e=function(a){function b(b){this.options={};for(var c in b)this.options[c]=b[c];this.el="string"==typeof this.options.el?a.querySelector(this.options.el):this.options.el,this.stage=this.options.stage||{dropped:function(){}},this.words=this.el.querySelectorAll("a"),this.el.className+=" edit",this.el._tap=new h({el:this.el}),this.el.addEventListener("tap",this,!1),a.addEventListener("touchend",this,!1),a.addEventListener("mouseup",this,!1)}return b.prototype.handleEvent=function(a){switch(a.type){case"touchend":case"mouseup":this.cancel(a);break;case"tap":this.edit(a)}},b.prototype.cancel=function(a){var b=a.target;b!=this.el&&b.parentNode!=this.el&&b.parentNode.parentNode!=this.el&&this.destroy()},b.prototype.edit=function(b){b.stopPropagation();var c,d=b.target,e=this.words.length;if("A"==d.tagName&&d!=this.words[e-1]){var f,g,h=this.el.cloneNode(!1);h.className=h.className.replace(/(^|\s)edit(\s|$)/g," ");for(var i=0;e>i;i++)this.words[i].parentNode!=g&&(f&&c&&f.querySelector("a")&&h.appendChild(f),f=a.createElement("p"),g=this.words[i].parentNode),c&&(f.appendChild(this.words[i]),g.querySelector("a")||g.parentNode.removeChild(g)),c||this.words[i]!=d||(c=!0);h.appendChild(f);var j=a.createElement("div");j.className="actions",h.appendChild(j),this.el.parentNode.insertBefore(h,this.el.nextSibling),this.el.handleHTML=this.el.innerHTML,this.stage.dropped(h),this.destroy()}},b.prototype.destroy=function(){this.el.className=this.el.className.replace(/(^|\s)edit(\s|$)/g," "),a.removeEventListener("touchend",this,!1),a.removeEventListener("mouseup",this,!1),this.el.removeEventListener("tap",this,!1),this.el._editBlock=null,this.el._tap.destroy(),this.el._tap=null},b}(b),f=function(a,b){function c(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}function d(a){if(!i){var c={time:2e3,color:"#000000",autostart:!0,crossFade:!0,autoplay:!0};for(var d in a)c[d]=a[d];video=b.querySelector("#stage-videos .active"),i=new e(video,c)}return i}function e(a,c){this.options=c,this.video=a,this.videoIncoming=b.getElementById("stage-video-"+("stage-video-1"==a.id?"2":"1")),this.servo=b.getElementById("fxHelper"),this.servo.style[h]="opacity 0ms",this.servo.style.left="0px",this.servo.style.opacity="0",this.servo.style.backgroundColor=this.options.color,this.options.autostart&&this.start()}var f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransition",a in f)return b[c].substr(0,b[c].length-1);return!1}(),h=c("transition");c("transform"),f=null;var i;return e.prototype.handleEvent=function(a){switch(a.type){case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this.transitionEnd(a)}},e.prototype.start=function(){this.phase="fadeOut",this.servo.addEventListener("transitionend",this,!1),this.servo.addEventListener("webkitTransitionEnd",this,!1),this.servo.addEventListener("oTransitionEnd",this,!1),this.servo.addEventListener("MSTransitionEnd",this,!1),this.servo.offsetHeight,this.servo.style[h]="opacity "+this.options.time+"ms";var a=this;setTimeout(function(){a.servo.style.opacity="1"},0)},e.prototype.transitionEnd=function(a){a.stopPropagation(),this.servo.removeEventListener("transitionend",this,!1),this.servo.removeEventListener("webkitTransitionEnd",this,!1),this.servo.removeEventListener("oTransitionEnd",this,!1),this.servo.removeEventListener("MSTransitionEnd",this,!1),this.video.pause(),"fadeOut"==this.phase?(this.options.onFadeOutEnd&&this.options.onFadeOutEnd.call(this),this.options.crossFade&&(this.phase="waiting",this.video.className=this.video.className.replace(/(^|\s)active($|\s)/,""),this.videoIncoming.className+=" active",this.fadeIn())):"fadeIn"==this.phase&&(this.options.onFadeInEnd&&this.options.onFadeInEnd.call(this),this.destroy())},e.prototype.fadeIn=function(){this.phase="fadeIn",this.servo.addEventListener("transitionend",this,!1),this.servo.addEventListener("webkitTransitionEnd",this,!1),this.servo.addEventListener("oTransitionEnd",this,!1),this.servo.addEventListener("MSTransitionEnd",this,!1),this.options.autoplay&&this.videoIncoming.play(),this.servo.style.opacity="0"},e.prototype.destroy=function(){this.servo.removeEventListener("transitionend",this,!1),this.servo.removeEventListener("webkitTransitionEnd",this,!1),this.servo.removeEventListener("oTransitionEnd",this,!1),this.servo.removeEventListener("MSTransitionEnd",this,!1),this.servo.style[h]="opacity 0ms",this.servo.style.opacity="0",this.servo.style.left="-9999px",i=null},d}(a,b),g=function(a,b){function c(b){this.options={el:"#sidemenu",transcripts:"#panel-media",music:"#panel-bgm",stage:null};for(var c in b)this.options[c]=b[c];this.el="string"==typeof this.options.el?a.querySelector(this.options.el):this.options.el,this.transcripts="string"==typeof this.options.transcripts?a.querySelector(this.options.transcripts):this.options.transcripts,this.music="string"==typeof this.options.music?a.querySelector(this.options.music):this.options.music,this.mediaCallback=this.options.callback;var d=a.querySelector("#sidemenu-handle");d._tap=new h({el:d}),d.addEventListener("tap",this.toggleMenu.bind(this),!1),this.updateStatus();var e=a.querySelectorAll("#sidemenu .tabbar li");for(c=e.length-1;c>=0;c--)e[c]._tap=new h({el:e[c]}),e[c].addEventListener("tap",this.selectPanel.bind(this),!1);this.initTranscripts(),this.initMusic()}return c.prototype.initTranscripts=function(){var c=this;b.api.getTranscripts(function(b){if(b){for(var d,e,f=0,g=this.transcripts.length;g>f;f++)e=this.transcripts[f],d=a.createElement("li"),d.setAttribute("data-id",e._id),d.innerHTML=e.label,c.transcripts.appendChild(d);c.transcripts._tap=new h({el:c.transcripts}),c.transcripts.addEventListener("tap",c.selectMedia.bind(c),!1)}})},c.prototype.initMusic=function(){function c(){b.addClass(f.target,"dragdrop")}function e(a){if(a){var c=a.innerHTML;b.addClass(a,"effect"),a.innerHTML="<form><div>"+c+'</div><label>Delay: <span class="value">1</span>s</label><input type="range" value="1" min="0.5" max="5" step="0.1" onchange="this.parentNode.querySelector(\'span\').innerHTML = this.value"></form>',f.dropped(a,c)}}var f=this.options.stage;if(f.target)for(var g=a.querySelectorAll("#panel-bgm li"),h=g.length-1;h>=0;h--)g[h]._dragInstance=new d({handle:g[h],dropArea:f.target,draggableClass:"draggableEffect",onDragStart:c,onDrop:e})},c.prototype.updateStatus=function(){this.opened=b.hasClass(this.el,"opened")},c.prototype.toggleMenu=function(){this.opened?this.close():this.open()},c.prototype.open=function(){this.opened||(b.addClass(this.el,"opened"),this.opened=!0)},c.prototype.close=function(){this.opened&&(b.removeClass(this.el,"opened"),this.opened=!1)},c.prototype.selectPanel=function(c){var d=a.querySelector("#sidemenu .tabbar li.selected"),e=c.currentTarget;b.removeClass(d,"selected"),b.addClass(e,"selected");var f="panel"+e.id.replace("sidemenu","");d=a.querySelector("#sidemenu .panel.selected"),b.removeClass(d,"selected"),e=a.querySelector("#"+f),b.addClass(e,"selected")},c.prototype.selectMedia=function(a){a.stopPropagation();var c=a.target;return b.hasClass(a.target.parentNode,"folder")&&(c=a.target.parentNode),b.hasClass(c,"folder")?(b.toggleClass(c,"open"),void 0):(c.getAttribute("data-id")&&this.mediaCallback&&this.mediaCallback(c),void 0)},c}(b,c),h=function(a,b,c){function d(a){this.options={};for(var c in a)this.options[c]=a[c];this.el="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.el.addEventListener("touchstart",this,!1),this.el.addEventListener("mousedown",this,!1)}return d.prototype={handleEvent:function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this._start(a);break;case"touchmove":case"mousemove":this._move(a);break;case"touchend":case"mouseup":case"touchcancel":case"mousecancel":this._end(a)}},_start:function(a){if(!(a.touches&&a.touches.length>1)){var b=a.touches?a.touches[0]:a;this.moved=!1,this.startX=b.pageX,this.startY=b.pageY,this.target=a.target,c.addClass(this.target,"tapPressed"),this.el.addEventListener("touchmove",this,!1),this.el.addEventListener("touchend",this,!1),this.el.addEventListener("touchcancel",this,!1),this.el.addEventListener("mousemove",this,!1),this.el.addEventListener("mouseup",this,!1),this.el.addEventListener("mousecancel",this,!1)}},_move:function(a){var b=a.changedTouches?a.changedTouches[0]:a,d=b.pageX,e=b.pageY;(Math.abs(d-this.startX)>10||Math.abs(e-this.startY)>10)&&(c.removeClass(this.target,"tapPressed"),this.moved=!0)},_end:function(a){if(c.removeClass(this.target,"tapPressed"),!this.moved){var d=b.createEvent("Event"),e=a.changedTouches?a.changedTouches[0]:a;d.initEvent("tap",!0,!0),d.pageX=e.pageX,d.pageY=e.pageY,this.target.dispatchEvent(d)}this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mousecancel",this,!1)},destroy:function(){this.el.removeEventListener("touchstart",this,!1),this.el.removeEventListener("touchmove",this,!1),this.el.removeEventListener("touchend",this,!1),this.el.removeEventListener("touchcancel",this,!1),this.el.removeEventListener("mousedown",this,!1),this.el.removeEventListener("mousemove",this,!1),this.el.removeEventListener("mouseup",this,!1),this.el.removeEventListener("mousecancel",this,!1)}},d}(a,b,c),i=function(a,b){function c(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}function d(a){if(!j){var b={el:null,text:"",speed:600,duration:3e3,background:"rgba(0,0,0,0.8)",color:"#ffffff"};for(var c in a)b[c]=a[c];j=new e(b)}return j}function e(a){this.options=a,this.el="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.el.innerHTML=this.options.text,this.el.style.backgroundColor=this.options.background,this.el.style.color=this.options.color,this.el.style.left="0px",this.el.style[i]="translate(0, 100%) translateZ(0)",this.el.addEventListener("transitionend",this,!1),this.el.addEventListener("webkitTransitionEnd",this,!1),this.el.addEventListener("oTransitionEnd",this,!1),this.el.addEventListener("MSTransitionEnd",this,!1),this.start()}var f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();c("transition");var h=c("transitionDuration"),i=c("transform");f=null;var j;return e.prototype.handleEvent=function(a){switch(a.type){case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this.transitionEnd(a)}},e.prototype.start=function(){this.phase="start",this.el.offsetHeight,this.el.style[h]=this.options.speed+"ms";var a=this;setTimeout(function(){a.el.style[i]="translate(0, 0) translateZ(0)"},0)},e.prototype.transitionEnd=function(a){return a.stopPropagation(),"start"==this.phase?(this.phase="waiting",this.timeout=setTimeout(this.end.bind(this),this.options.duration),void 0):(this.options.onEnd&&this.options.onEnd.call(this),this.destroy(),void 0)},e.prototype.end=function(){this.phase="end",this.el.style[i]="translate(0, 100%) translateZ(0)"},e.prototype.destroy=function(){clearTimeout(this.timeout),this.el.removeEventListener("transitionend",this,!1),this.el.removeEventListener("webkitTransitionEnd",this,!1),this.el.removeEventListener("oTransitionEnd",this,!1),this.el.removeEventListener("MSTransitionEnd",this,!1),this.el.style[h]="0s",this.el.style.left="-9999px",j=null},d}(a,b),j=function(a,b,c){function d(a){var b=(a.innerText||a.textContent).split(" ");a.innerHTML="<a>"+b.join(" </a><a>")+"</a>"}function e(a){this.options={el:null,addHelpers:!1,touch:!0,mouse:!0,threshold:10};for(var c in a)this.options[c]=a[c];this.element="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.options.addHelpers&&d(this.element),this.words=this.element.querySelectorAll("a"),this.wordsCount=this.words.length,this.options.touch&&this.element.addEventListener("touchstart",this,!1),this.options.mouse&&this.element.addEventListener("mousedown",this,!1)}return e.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},e.prototype.start=function(b){b.preventDefault(),b.touches?b.touches[0]:b,this.selectStarted=!1,this.startX=b.pageX,this.startY=b.pageY,this.options.mouse&&(this.element.addEventListener("mousemove",this,!1),a.addEventListener("mouseup",this,!1)),this.options.touch&&(this.element.addEventListener("touchmove",this,!1),a.addEventListener("touchend",this,!1)),c.hasClass(b.target,"selected")&&(this.dragTimeout=setTimeout(this.dragStart.bind(this,b),500))},e.prototype.selectStart=function(a){var b,d=a.target;if(d!=this.element&&"A"==d.tagName){if(this.selectStarted=!0,this.currentWord=d,c.removeClass(this.element.querySelector(".first"),"first"),c.removeClass(this.element.querySelector(".last"),"last"),this.words[this.startPosition]===d)return b=this.startPosition,this.startPosition=this.endPosition,this.endPosition=b,void 0;if(this.words[this.endPosition]!==d){for(var e=0;e<this.wordsCount;e++)this.words[e]==d&&(this.startPosition=e),c.removeClass(this.words[e],"selected");this.endPosition=this.startPosition,c.addClass(d,"selected")}}},e.prototype.move=function(a){var d,e=a.changedTouches?a.changedTouches[0]:a,f=a.touches?b.elementFromPoint(e.pageX,e.pageY):e.target;if(!(Math.abs(e.pageX-this.startX)<this.options.threshold&&Math.abs(e.pageY-this.startY)<this.options.threshold)){if(clearTimeout(this.dragTimeout),!this.selectStarted)return this.selectStart(a),void 0;if("P"==f.tagName&&(f=f.querySelector("a:last-child")),f!=this.element&&f!=this.currentWord&&"A"==f.tagName){for(var g=0;g<this.wordsCount;g++)this.words[g]==f&&(d=g),void 0===d&&g>=this.startPosition||void 0!==d&&g<=this.startPosition||d==g?c.addClass(this.words[g],"selected"):c.removeClass(this.words[g],"selected");this.currentWord=f,this.endPosition=d}}},e.prototype.end=function(a){if(clearTimeout(this.dragTimeout),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),!this.selectStarted)return a.target==this.element&&this.clearSelection(),void 0;var b=Math.min(this.startPosition,this.endPosition),d=Math.max(this.startPosition,this.endPosition);c.addClass(this.words[b],"first"),c.addClass(this.words[d],"last")},e.prototype.clearSelection=function(){this.currentWord=null,this.startPosition=null,this.endPosition=null,c.removeClass(this.element.querySelector(".first"),"first"),c.removeClass(this.element.querySelector(".last"),"last"),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1));for(var a=this.element.querySelectorAll(".selected"),b=0,d=a.length;d>b;b++)c.removeClass(a[b],"selected")},e.prototype.getSelection=function(){for(var a,b=this.element.querySelectorAll(".selected"),c="",d=0,e=b.length;e>d;d++)b[d].parentNode!==a&&(a=b[d].parentNode,c+=0===d?"<p>":"</p><p>"),c+=b[d].outerHTML.replace(/ class="[\d\w\s\-]*\s?"/gi," ");return c&&(c+="</p>"),c},e.prototype.dragStart=function(a){a.stopPropagation(),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),a.changedTouches?a.changedTouches[0]:a,this.options.onDragStart&&this.options.onDragStart.call(this,a)},e.prototype.destroy=function(){this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),this.element.removeEventListener("mousedown",this,!1),this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)},e}(a,b,c),k=function(a){return function(b){b=a.extend({url:"",data:"",type:"GET",responseType:"",async:!0,withCredentials:!0,timeout:0,cache:!0},b),b.cache||(b.url=b.url+(/\?/.test(b.url)?"&":"?")+(new Date).getTime());var c=new XMLHttpRequest;return c.addEventListener("load",function(a){200===this.status?"function"==typeof b.complete&&b.complete.call(this,a):"function"==typeof b.error&&b.error.call(this,a)},!1),"function"==typeof b.error&&(c.addEventListener("error",function(a){b.error.call(this,a)},!1),c.addEventListener("abort",function(a){b.error.call(this,a)},!1)),c.open(b.type,b.url,b.async),c.responseType=b.responseType,c.withCredentials=b.withCredentials,c.timeout=b.timeout,b.data&&c.setRequestHeader("content-type","application/json; charset=utf-8"),c.send(b.data),c}}(c),l=function(a){return{init:function(b){this.options=a.extend({api:"http://data.hyperaud.io/",transcripts:"transcripts/",mixes:"mixes/",whoami:"whoami/"},b),this.error=!1,this.guest=!1,this.username="",this.transcripts=null,this.transcript=null,this.mixes=null,this.mix=null},callback:function(a,b){"function"==typeof a&&a.call(this,b)},getUsername:function(a,b){var c=this;b||!this.guest&&!this.username?k({url:this.options.api+this.options.whoami,complete:function(){var b=JSON.parse(this.responseText);c.guest=!b.user,c.username=c.guest?"":b.user.username,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}}):setTimeout(function(){c.callback(a,!0)},0)},getTranscripts:function(a,b){var c=this;!b&&this.transcripts?setTimeout(function(){c.callback(a,!0)},0):k({url:this.options.api+this.options.transcripts,complete:function(){var b=JSON.parse(this.responseText);c.transcripts=b,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}})},getTranscript:function(a,b,c){var d=this;!c&&this.transcript&&this.transcript._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?k({url:d.options.api+(d.guest?"":d.username+"/")+d.options.transcripts+a,complete:function(){var a=JSON.parse(this.responseText);d.transcript=a,d.callback(b,!0)},error:function(){d.error=!0,d.callback(b,!1)}}):(d.error=!0,d.callback(b,!1))})},getMixes:function(a,b){var c=this;!b&&this.mixes?setTimeout(function(){c.callback(a,!0)},0):this.getUsername(function(b){b?k({url:c.options.api+(c.guest?"":c.username+"/")+c.options.mixes,complete:function(){var b=JSON.parse(this.responseText);c.mixes=b,c.callback(a,!0)},error:function(){c.error=!0,c.callback(a,!1)}}):(c.error=!0,c.callback(a,!1))})},getMix:function(a,b,c){var d=this;!c&&this.mix&&this.mix._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?k({url:this.options.api+(this.guest?"":this.username+"/")+this.options.mixes+a,complete:function(){var a=JSON.parse(this.responseText);d.mix=a,d.callback(b,!0)},error:function(){d.error=!0,d.callback(b,!1)}}):(d.error=!0,d.callback(b,!1))})},putMix:function(a,b){var c=this;if("object"==typeof a){var d="POST",e="";this.mix&&this.mix._id&&this.mix._id===a._id&&(d="PUT",e=this.mix._id),this.getUsername(function(f){f&&!this.guest&&this.username?k({url:c.options.api+c.username+"/"+c.options.mixes+e,type:d,data:JSON.stringify(a),complete:function(){var a=JSON.parse(this.responseText);c.mix=a,c.callback(b,!0)},error:function(){c.error=!0,c.callback(b,!1)}}):c.callback(b,!1)},!0)}else setTimeout(function(){c.callback(b,!1)},0)}}}(c),m=function(a,b,c,d){function e(d){this.options=c.extend({},this.options,{entity:"PLAYER",target:"#transcript-video",media:{mp4:"",webm:""},mediaType:{mp4:"video/mp4",webm:"video/webm"},guiNative:!1,gui:!1,cssClassPrefix:"hyperaudio-player-",async:!0},d),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.videoElem=null,this.sourceElem=null,this.timeout={},this.commandsIgnored=/ipad|iphone|ipod|android/i.test(a.navigator.userAgent),this.gui=null,this.options.DEBUG&&this._debug(),this.target&&this.create()}return e.prototype={create:function(){this.target?(this.videoElem=b.createElement("video"),this.videoElem.controls=this.options.guiNative,this.videoElem.addEventListener("progress",function(){this.readyState>0&&(this.commandsIgnored=!1)},!1),this.target.innerHTML="",this.target.appendChild(this.videoElem),this.options.gui&&(this.addGUI(),this.addGUIListeners()),this.options.media.mp4&&this.load()):this._error("Target not found : "+this.options.target)},addGUI:function(){var a=this;this.target?(this.gui={container:this.target,gui:b.createElement("div"),controls:b.createElement("div"),play:b.createElement("a"),pause:b.createElement("a")},c.each(this.gui,function(b){c.addClass(this,a.options.cssClassPrefix+b)}),this.gui.play.addEventListener("click",function(b){b.preventDefault(),a.play()},!1),this.gui.pause.addEventListener("click",function(b){b.preventDefault(),a.pause()},!1),this.gui.pause.style.display="none",this.gui.gui.appendChild(this.gui.controls),this.gui.controls.appendChild(this.gui.play),this.gui.controls.appendChild(this.gui.pause),this.target.appendChild(this.gui.gui)):this._error("Target not found : "+this.options.target)},addGUIListeners:function(){var a=this;this.gui?this.videoElem.addEventListener("ended",function(){a.gui.play.style.display="",a.gui.pause.style.display="none"},!1):this._error("GUI not used: gui = "+this.options.gui)},load:function(a){var d=this;if(a&&(this.options.media=a),this.videoElem&&"object"==typeof this.options.media){for(this.killPopcorn(),this.sourceElem={};this.videoElem.firstChild;)this.videoElem.removeChild(this.videoElem.firstChild);c.each(this.options.media,function(a,c){var e=d.sourceElem[a]=b.createElement("source");e.setAttribute("type",d.options.mediaType[a]),e.setAttribute("src",c),d.videoElem.appendChild(e)}),this.videoElem.load(),this.initPopcorn()}else this._error("Video player not created : "+this.options.target)},initPopcorn:function(){this.killPopcorn(),this.popcorn=d(this.videoElem)},killPopcorn:function(){this.popcorn&&(this.popcorn.destroy(),delete this.popcorn)},play:function(a){this.gui&&(this.gui.play.style.display="none",this.gui.pause.style.display=""),this.currentTime(a,!0)},pause:function(a){this.gui&&(this.gui.play.style.display="",this.gui.pause.style.display="none"),this.videoElem.pause(),this.currentTime(a)},currentTime:function(a,b){var c=this,d=this.videoElem;if(clearTimeout(this.timeout.currentTime),"number"!=typeof a||isNaN(a))b&&d.play();else{b&&this.commandsIgnored&&d.play();try{if(d.seekable&&!("object"==typeof d.seekable&&d.seekable.length>0))throw 1;d.currentTime=a,b&&d.play()}catch(e){this.timeout.currentTime=setTimeout(function(){c.currentTime(a,b)},250)}}}},e}(a,b,c,Popcorn),n=function(a,b){function c(c){this.options=b.extend({},this.options,{entity:"TRANSCRIPT",target:"#transcript",id:"",media:{},group:"p",word:"a",timeAttr:"data-m",unit:.001,async:!0,stage:null,player:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.textSelect=null,this.options.DEBUG&&this._debug(),this.options.id&&this.load()}return c.prototype={load:function(a){var c=this;this.ready=!1,a&&(this.options.id=a);var d=function(){c.options.async?setTimeout(function(){c.setVideo()},0):c.setVideo()};this.target&&(this.target.innerHTML="",b.api.getTranscript(this.options.id,function(a){a?(c.target.innerHTML=this.transcript.content,c._trigger(b.event.load,{msg:'Loaded "'+c.options.id+'"'})):(c.target.innerHTML="Problem with transcript URL.",c._error(this.status+" "+this.statusText+' : "'+c.options.id+'"')),d()}))},setVideo:function(){var a=this;if(this.options.player&&b.api.transcript){var c=b.api,d=c.options.api+c.transcript.media.owner+"/"+c.transcript.media.meta.filename;this.options.media={mp4:d,webm:d.replace(/\.mp4$/,".webm")},this.options.player.load(this.options.media),this.options.async?setTimeout(function(){a.parse()},0):this.parse()}else this._error("Player not defined"),this.selectorize()},parse:function(){var a=this.options;if(this.target&&a.player&&a.player.popcorn){var b,c=this.target.querySelectorAll(a.target+" "+a.word),d=c.length,e=function(){};for(b=0;d>b;b++)a.player.popcorn.transcript({time:c[b].getAttribute(a.timeAttr)*a.unit,futureClass:"transcript-grey",target:c[b],onNewPara:e});this.target.addEventListener("click",function(b){if(b.preventDefault(),b.target.nodeName.toLowerCase()===a.word){var c=b.target.getAttribute(a.timeAttr),d=c*a.unit;a.player.currentTime(d)}},!1)}this.selectorize()},selectorize:function(){var a=this,c=this.options;c.stage&&(this.deselectorize(),this.textSelect=new j({el:c.target,onDragStart:function(e){b.addClass(c.stage.target,c.stage.options.dragdropClass);var f=new d({dropArea:c.stage.target,init:!1,onDrop:function(b){a.textSelect.clearSelection(),this.destroy(),b&&(b.setAttribute(c.stage.options.idAttr,c.id),b.setAttribute(c.stage.options.mp4Attr,c.media.mp4),b.setAttribute(c.stage.options.webmAttr,c.media.webm),b.setAttribute(c.stage.options.unitAttr,c.unit),c.stage.dropped(b))}}),g=this.getSelection().replace(/ class="[\d\w\s\-]*\s?"/gi,"")+'<div class="actions"></div>';f.init(g,e)}}),this.ready=!0,this._trigger(b.event.ready))},deselectorize:function(){this.textSelect&&this.textSelect.destroy(),delete this.textSelect},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),o=function(a,b){function c(c){this.options=b.extend({},this.options,{entity:"STAGE",target:"#stage",id:"",title:"Test from hyperaudio.stage.js",desc:"Testing initial save system",type:"beta",idAttr:"data-id",mp4Attr:"data-mp4",webmAttr:"data-webm",unitAttr:"data-unit",dragdropClass:"dragdrop",async:!0,projector:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.article=a.createElement("article"),this.mix={},this.target.appendChild(this.article),this.options.DEBUG&&this._debug(),this.options.projector&&this.options.projector.setStage(this),this.options.id&&this.load()}return c.prototype={mixDetails:function(a){b.extend(this.options,a)},load:function(c){var d=this;c&&(this.options.id=c),this.target&&b.api.getMix(c,function(c){if(c){d.mix=b.extend({},this.mix);var e=a.createElement("div");e.innerHTML=d.mix.content;var f=e.querySelector("article");d.article.innerHTML=f.innerHTML;for(var g=f.attributes,h=0,i=g.length;i>h;h++)d.article.setAttribute(g[h].name,g[h].value);d.initDragDrop(),d._trigger(b.event.load,{msg:"Loaded mix"})}else d._error(this.status+" "+this.statusText+' : "'+url+'"')})},save:function(a){var c=this;b.extend(this.mix,{label:this.options.title,desc:this.options.desc,meta:{},sort:999,type:this.options.type,content:this.target.innerHTML}),this.target&&b.api.putMix(this.mix,function(d){d?(c.mix=b.extend({},this.mix),c._trigger(b.event.save,{msg:"Saved mix"}),c.callback(a,!0)):(c._error(this.status+" "+this.statusText+' : "'+url+'"'),c.callback(a,!1))})},callback:function(a,b){"function"==typeof a&&a.call(this,b)},clear:function(){this.article.innerHTML="",this.mix={},this.options.id=""},parse:function(){this.options},initDragDrop:function(){var a,b,c,d=this;if(this.target)for(c=this.target.getElementsByTagName("section"),b=c.length,a=0;b>a;a++)d.dropped(c[a])},dropped:function(a,c){var f,g=this,i="",j=function(a){a.stopPropagation(),this.parentNode._editBlock=new e({el:this.parentNode,stage:g})};this.target&&(b.removeClass(this.target,this.options.dragdropClass),/(^|\s)effect($|\s)/.test(a.className)?i="draggableEffect":(f=a.querySelector(".actions"),f._tap=new h({el:f}),f.addEventListener("tap",j,!1)),a._dragInstance=new d({handle:a,dropArea:this.target,html:c?c:a.innerHTML,draggableClass:i,onDragStart:function(){b.addClass(g.target,g.options.dragdropClass)},onDrop:function(){b.removeClass(g.target,g.options.dragdropClass)}}))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),p=function(a,b,c){function d(a){this.options=c.extend({},this.options,{entity:"PROJECTOR",target:"#transcript-video",tPadding:1,players:1,unit:.001,gui:!0,cssClassPrefix:"hyperaudio-player-",async:!0},a),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.stage=null,this.player=[],this.media=[],this.current={},this.gui=null,this.paused=!0,this.options.DEBUG&&this._debug(),this.target&&this.create()}return d.prototype={setStage:function(a){this.stage=a},create:function(){var a=this;if(this.target){for(var d=function(b){a.manager(b)},e=0;e<this.options.players;e++){var f=b.createElement("div");this.player[e]=c.Player({target:f}),this.player[e].videoElem.addEventListener("timeupdate",d,!1),this.target.appendChild(f)}this.options.gui&&this.addGUI(),this.options.media&&this.load()}else this._error("Target not found : "+this.options.target)},addGUI:m.prototype.addGUI,load:function(a){a&&(this.options.media=a),this.media[0]=this.options.media,this.player[0]?(c.addClass(this.player[0].videoElem,"active"),this.player[0].load(this.media[0])):this._error("Video player not created : "+this.options.target)},play:function(){this.stage&&this.stage.target?(this.stageArticle=this.stage.target.getElementsByTagName("article")[0],this.current.sections=this.stageArticle.getElementsByTagName("section"),this.setCurrent(0),this.paused=!1,this.load(this.current.media),this._play(this.current.start)):this.paused=!0},pause:function(){this.paused=!0,this._pause()},_play:function(a){this.gui&&(this.gui.play.style.display="none",this.gui.pause.style.display=""),this.player[0].play(a)},_pause:function(a){this.gui&&(this.gui.play.style.display="",this.gui.pause.style.display="none"),this.player[0].pause(a)},currentTime:function(a,b){this.player[0].currentTime(a,b)},setCurrent:function(a){this.current.index=a,this.current.section=this.current.sections[this.current.index],this.current.id=this.current.section.getAttribute(this.stage.options.idAttr),this.current.media={mp4:this.current.section.getAttribute(this.stage.options.mp4Attr),webm:this.current.section.getAttribute(this.stage.options.webmAttr)};var b=1*this.current.section.getAttribute(this.stage.options.unitAttr);this.current.unit=b=b>0?b:this.options.unit;var c=this.current.section.getElementsByTagName("a");this.current.start=c[0].getAttribute("data-m")*b,this.current.end=c[c.length-1].getAttribute("data-m")*b},manager:function(){this.paused||this.player[0].videoElem.currentTime>this.current.end+this.options.tPadding&&(++this.current.index<this.current.sections.length?(this.setCurrent(this.current.index),this.load(this.current.media),this._play(this.current.start)):(this.current.index=0,this.paused=!0,this._pause()))}},d}(a,b,c,Popcorn);return c.register("Player",m),c.register("Transcript",n),c.register("Stage",o),c.register("Projector",p),c.utility("api",l),c.utility("DragDrop",d),c.utility("EditBlock",e),c.utility("fadeFX",f),c.utility("SideMenu",g),c.utility("Tap",h),c.utility("titleFX",i),c.utility("WordSelect",j),c.utility("xhr",k),c}(window,document),HAP={};HAP.init=function(a,b){function c(){function a(a){var b=a.getAttribute("data-id");i.close(),h.load(b)}HA.api.init(),e=HA.Player({target:"#video-source",guiNative:!0}),f=HA.Projector({target:"#stage-videos"}),g=HA.Stage({target:"#stage",projector:f}),h=HA.Transcript({target:"#transcript",stage:g,player:e}),j=b.getElementById("mix-title"),k=b.getElementById("save-button"),i=new HA.SideMenu({el:"#sidemenu",stage:g,callback:a}),j.addEventListener("change",function(){g.mixDetails({title:this.value})}),g.target.addEventListener(HA.event.load,function(){j.value=HA.api.mix.label}),k._tap=new HA.Tap({el:k}),k.addEventListener("tap",function(){g.save()},!1),l=new HA.DragDrop({handle:"#fadeFX",dropArea:g.target,draggableClass:"draggableEffect",onDragStart:function(){HA.addClass(g.target,"dragdrop")},onDrop:function(a){a&&(a.className+=" effect",a.innerHTML='<form><label>Fade Effect: <span class="value">1</span>s</label><input type="range" value="1" min="0.5" max="5" step="0.1" onchange="this.parentNode.querySelector(\'span\').innerHTML = this.value"></form>',g.dropped(a,"Fade"))}}),m=new HA.DragDrop({handle:"#pauseFX",dropArea:g.target,draggableClass:"draggableEffect",onDragStart:function(){HA.addClass(g.target,"dragdrop")},onDrop:function(a){a&&(a.className+=" effect",a.innerHTML='<form><label>Pause: <span class="value">1</span>s</label><input type="range" value="1" min="0.5" max="5" step="0.1" onchange="this.parentNode.querySelector(\'span\').innerHTML = this.value"></form>',g.dropped(a,"Pause"))}}),n=new HA.DragDrop({handle:"#titleFX",dropArea:g.target,draggableClass:"draggableEffect",onDragStart:function(){HA.addClass(g.target,"dragdrop")},onDrop:function(a){a&&(a.className+=" effect",a.innerHTML='<form><label>Title: <span class="value">1</span>s</label><input type="text" value="Title"><input type="range" value="1" min="0.5" max="5" step="0.1" onchange="this.parentNode.querySelector(\'span\').innerHTML = this.value"></form>',g.dropped(a,"Title"))}})}function d(){}var e,f,g,h,i,j,k,l,m,n;return a.addEventListener("load",c,!1),b.addEventListener("touchmove",function(a){a.preventDefault()},!1),d}(window,document);